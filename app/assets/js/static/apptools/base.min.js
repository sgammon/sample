(function(){var e,t,n,r,i,s,o,a,l,u,c,f,p,h,d,g,y,v,m,b,A,S,w,C,T,E,k,N,I,R,L,x,O,q,j,P,D,Y,M,F,G,U,z,H,V,K,W,B,J,X,Q,Z,et,tt,nt,rt,it,st,ot,at,lt,ut,ct,ft,pt,ht,dt,_t,gt,yt,vt,mt,bt={}.hasOwnProperty,At=function(e,t){for(var n in t){if(bt.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},St=[].slice,wt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},Ct=this,Tt=function(e,t){return function(){return e.apply(t,arguments)}};ht=["installed_drivers","installed_integrations","abstract_base_classes","abstract_feature_interfaces","deferred_core_modules","deferred_library_integrations"];this.__apptools_preinit={};for(dt=0,gt=ht.length;dt<gt;dt++){ft=ht[dt];this.__apptools_preinit[ft]=[]}i=function(){e.prototype.install=function(e,t){if(e.apptools!=null){e.apptools.sys.modules.install(t)}e.__apptools_preinit.deferred_core_modules.push(t);return t};function e(e,t){if((e!=null?e.events:void 0)!=null){this.events=e.events}return}return e}();window.CoreAPI=i;p=function(){function e(){}e.prototype.install=function(e,t){e.__apptools_preinit.abstract_base_classes.push(t);return t};return e}();window.CoreObject=p;a=function(e){At(t,e);t.prototype.name=null;t.prototype.library=null;t.prototype["interface"]=[];function t(e){this}t.prototype.install=function(e,t){if(e.apptools!=null){e.apptools.sys.drivers.install(t)}e.__apptools_preinit.installed_drivers.push(t);e[t.name]=t;return t};return t}(p);window.CoreDriver=a;c=function(e){At(t,e);t.prototype.parent=null;t.prototype.required=[];t.prototype.capability=null;t.prototype["static"]=true;function t(e){this.drivers={adapters:{},priority:[],selected:null}}t.prototype.install=function(e,t){if(e.apptools!=null){e.apptools.sys.interfaces.install(t)}e.__apptools_preinit.abstract_feature_interfaces.push(t);e[t.name]=t;return t};t.prototype.add=function(e){this.drivers.adapters[e.name]=e;this.drivers.priority.push(e.name)};t.prototype.resolve=function(e){var t,n,r,i,s;if(e!=null){if(this.drivers.adapters[e]!=null){return this.drivers.adapters[e]}return false}if(this["static"]&&this.drivers.selected!=null){return this.drivers.adapters[this.drivers.selected]}else{n=-1;s=this.drivers.priority;for(r=0,i=s.length;r<i;r++){t=s[r];if(t.priority!=null&&t.priority>n){this.drivers.selected=t}else{if(!(t.priority!=null)){this.drivers.selected=t}continue}}if(this.drivers.selected===null){return false}return this.drivers.adapters[this.drivers.selected]}};return t}(p);window.CoreInterface=c;u=function(e){At(t,e);function t(e,t,n){this.module=e;this.message=t;this.context=n}t.prototype.toString=function(){return"["+this.module+"] CoreException: "+this.message};t.prototype.install=function(e,t){e.__apptools_preinit.abstract_base_classes.push(t);return t};return t}(Error);window.CoreException=u;n=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(a);r=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(u);window.AppToolsDriver=n;window.AppToolsException=r;b=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(a);w=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(c);window.Driver=b;window.Interface=w;this.__apptools_preinit.abstract_base_classes.push(i,p,c,a,u,r,b,w);ct=function(){e.mount="util";e.events=["DOM_READY"];function e(){var e=this;if(arguments.length>0){return _.get.apply(_,arguments)}if(window._!=null&&window._.resolve_common_ancestor!=null){return window._}this._state={active:null,init:false,dom_status:null,dom_ready:false,queues:{fx:[],dom:[],deferred:[],ready:[],"default":[]},counts:{fx:0,dom:0,deferred:0,ready:0,"default":0},handlers:{"default":function(e){console.log("Default queue handler called on Util, returning queue: ",e);return e},ready:function(t){if(document.readyState="complete"){document.removeEventListener("DOMContentLoaded",e._state.handlers.ready,false);e._state.dom_ready=true;e._state.dom_status="READY";return $.apptools.events.trigger("DOM_READY")}}},callbacks:{"default":null}};this.internal={queues:{create:function(t,n,r){if(r==null){r="handler"}r+="s";e._state.queues[t]=[];e._state.counts[t]=0;e._state[r][t]=n},remove:function(t,n){var r,i,s;r=e._state.handlers[t];delete e._state.handlers[t];i=e._state.queues[t];delete e._state.queues[t];s=i.length>0?{queue:i,handler:r}:true;if(n!=null){return n(s)}else{return s}},add:function(t,n){if(!(n!=null)){n=t;t="default"}e._state.queues[t].push(n);return e._state.counts[t]++},set_handler:function(t,n){return e._state.handlers[t]=n},set_callback:function(t,n){return e._state.callbacks[t]=n},go:function(t,n){var r,i;e._state.counts[t]--;if(e._state.handlers[t]&&e.is_array(n)){i=n;return e._state.handlers[t](i)}else if(e._state.callbacks[t]){r=n;return e._state.callbacks[t](r)}else{if(e.is_function(n)){return n.call(window,window)}else{return n}}},process:function(t){var n,r,i,s,o;n=e._state.queues[t];e._state.queues[t]=[];r=[];for(i=0,s=n.length;i<s;i++){o=n[i];r.push(e.internal.queues.go(t,o))}return r}}};this.is=function(t){return!e.in_array([false,null,NaN,void 0,0,{},[],"","false","False","null","NaN","undefined","0","none","None"],t)};this.has=function(e,t){return{}.hasOwnProperty.call(e,t)};this.is_function=function(t){return e.type_of(t)==="function"};this.is_object=function(t){return e.type_of(t)==="object"};this.is_raw_object=function(t){if(!t||e.type_of(t)!=="object"||t.nodeType||e.is_window(t)){return false}if(t.constructor!=null&&!t.hasOwnProperty("constructor")&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")){return false}return true};this.is_empty_object=function(e){var t;for(t in e){return false}return true};this.is_window=function(e){return!!e.setInterval||e.self!=null&&e.self===e||typeof Window!=="undefined"&&Window!==null&&e instanceof Window};this.is_body=function(t){return e.is_object(t)&&(Object.prototype.toString.call(t)==="[object HTMLBodyElement]"||t.constructor.name==="HTMLBodyElement")};this.is_array=Array.isArray||function(t){return e.type_of(t)==="array"};this.is_string=function(t){return e.type_of(t)==="string"};this.attr=function(e,t,n){if(!t||!e){return false}if(n!=null){e.setAttribute(t,n);return e}else{return e.getAttribute(t)}};this.data=function(t,n,r){var i,s,o,a,l,u,c,f,p;if(t==null){t=document}l=/^data-(\w*)$/;if(!(n!=null)&&!(r!=null)){r={};s=t.attributes;for(f=0,p=s.length;f<p;f++){i=s[f];if(l.test(i.name)){a=l.exec(i.name)[1];r[a]=e.data(t,a)}}return e.is_empty_object(r)?null:r}if(e.is_raw_object(n)){for(o in n){u=n[o];e.data(t,o,u)}return t}n=l.test(n)?n:"data-"+n;if(r!=null){if(r===false){return t.removeAttribute(n)}if(e.is_object(r)||e.is_array(r)){r=e.JSON_to_safe(JSON.stringify(r))}t.setAttribute(n,r);return t}else{c=t.getAttribute(n)||false;if(!!c){if(e.is_JSON(c)){return JSON.parse(e.safe_to_JSON(c))}else{return c}}else{return null}}};this.is_JSON=function(t){return e.is_string(t)&&/[\{\[](?:.*)[\}\]]/.test(t)};this.JSON_to_safe=function(e){return e.split('"').join("'")};this.safe_to_JSON=function(e){return e.split("'").join('"')};this.in_array=function(t,n){return!!~e.indexOf(t,n)};this.to_array=function(t){var n;if(!t){return false}if(e.is_array(t)){return t}if(!(t.length!=null)){return[t]}n=[];for(pt=t.length;pt--;n.unshift(t[pt]));return n};this.join=function(){var t,n,r,i,s,o,a,l;r=e.to_array(arguments);i=[];for(s=0,a=r.length;s<a;s++){n=r[s];n=e.to_array(n);for(o=0,l=n.length;o<l;o++){t=n[o];i.push(t);continue}continue}return i};this.indexOf=function(t,n){var r,i,s,o;if(e.is_array(t)){if((dt=Array.prototype.indexOf)!=null){return dt.call(t,n)}else{r=t.length;while(r--){if(t[r]===n){return r}}return-1}}else if(e.is_object(t)){s=-1;for(i in t){if(!bt.call(t,i))continue;o=t[i];if(o!==n){continue}s=i;break}return s}else{throw"indexOf() requires an iterable as the first parameter"}};this.each=function(t,n,r){var i,s,o,a,l,u,c,f;if(r==null){r=window}if(e.type_of(n)!=="function"){throw"each() requires an iterator as the second parameter"}else{a=[];if(e.is_array(t)){if((u=Array.prototype.forEach)!=null){return u.call(t,n,r)}for(i=c=0,f=t.length;c<f;i=++c){s=t[i];a.push(n.call(r,s,i,t))}}else if(e.is_object(t)){for(o in t){l=t[o];a.push(n.call(r,l,o,t))}}else{throw"each() requires an iterable as the first parameter"}}};this.map=function(t,n,r){var i,s,o,a,l,u,c,f;if(r==null){r=window}if(e.type_of(n)!=="function"){throw"map() requires an iterator as the second parameter"}else{if(e.is_array(t)){if((f=Array.prototype.map)!=null){return f.call(t,n,r)}a=[];for(i=u=0,c=t.length;u<c;i=++u){s=t[i];a.push(n.call(r,s,i,t))}}else if(e.is_object(t)){a={};for(o in t){if(!bt.call(t,o))continue;l=t[o];a[o]=n.call(r,l,o,t)}}else{throw"map() requires an iterable as the first parameter"}return a}};this.filter=function(t,n,r){var i,s,o,a,l,u,c,f;if(r==null){r=window}if(e.type_of(n)!=="function"){throw"filter() requires an iterator as the second parameter"}else{if(e.is_array(t)){if((u=Array.prototype.filter)!=null){return u.call(t,n,r)}a=[];for(i=c=0,f=t.length;c<f;i=++c){s=t[i];if(n.call(r,s,i,t)){a.push(s)}}}else if(e.is_object(t)){a={};for(o in t){if(!bt.call(t,o))continue;l=t[o];if(n.call(r,l,o,t)){a[o]=l}}}else{throw"filter() requires an iterable as the first parameter"}return a}};this.reject=function(t,n,r){var i,s,o,a,l,u,c;if(r==null){r=window}if(e.type_of(n)!=="function"){throw"reject() requires an iterator as the second parameter"}else{if(e.is_array(t)){a=[];for(i=u=0,c=t.length;u<c;i=++u){s=t[i];if(!n.call(r,s,i,t)){a.push(s)}}}else if(e.is_object(t)){a={};for(o in t){if(!bt.call(t,o))continue;l=t[o];if(!n.call(r,l,o,t)){a[o]=l}}}else{throw"reject() requires an iterable as the first parameter"}return a}};this.exclude=function(t,n){var r,i,s,o,a,l;if(e.is_array(t)){s=[];for(a=0,l=t.length;a<l;a++){r=t[a];if(!!!~e.indexOf(n,r)){s.push(r)}}}else if(e.is_object(t)){s={};for(i in t){o=t[i];if(!!!~e.indexOf(n,i)){s[i]=o}}}else{throw"exclude() requires two iterables"}return s};this.all=function(t,n,r){var i,s,o,a,l,u;if(r==null){r=window}if(e.type_of(n)!=="function"){throw"all() requires an iterator as the second parameter"}else{if((a=e.is_array(t))||(l=e.is_object(t))){if(a){if((o=Array.prototype.every)!=null){return o.call(t,n,r)}}s=e.reject(t,n,r);if(a){return s.length===0}else{u=[];for(i in l){u.push(false)}return u}}else{throw"all() requires an iterable as the first parameter"}}};this.any=function(t,n,r){var i,s,o,a,l,u;if(r==null){r=window}if(e.type_of(n)!=="function"){throw"any() requires an iterator as the second parameter"}else{if((a=e.is_array(t))||(l=e.is_object(t))){if(a){if((o=Array.prototype.some)!=null){return o.call(t,n,r)}}s=e.filter(t,n,r);if(a){return s.length>0}else{u=[];for(i in l){u.push(true)}return u}}else{throw"any() requires an iterable as the first parameter"}}};this.reduce=function(t,n,r,i){var s,o,a,l,u;if(i==null){i=window}if(r==null){r=e.is_array(t[0])?[]:0}if(e.type_of(n)!=="function"){throw"reduce() requires an iterator as the second parameter"}else{if(e.is_array(t)){if((u=Array.prototype.reduce)!=null){return u.call(t,n,r,i)}o=r;for(a=0,l=t.length;a<l;a++){s=t[a];n.call(i,o,s,t)}return o}else{throw"reduce() requires an array as the first parameter"}}};this.reduce_right=function(t,n,r,i){var s;if(i==null){i=window}if(r==null){r=e.is_array(t[s=t.length-1])?[]:0}if(e.type_of(n)!=="function"){throw"reduce_right() requires an iterator as the second parameter"}else{if(e.is_array(t)){return e.reduce(t.reverse(),n,r,i)}else{throw"reduce_right() requires an array as the first parameter"}}};this.sort=function(t,n){var r;if(n!=null&&e.type_of(n)!=="function"){throw"sort() requires an iterator as the second parameter"}else if((r=Array.prototype.sort)!=null){return r.call(t,n)}else{console.log("non-native sort() currently stubbed.");return false}};this.defaults=function(t,n){var r,i,s,o,a,l,u;if(n==null){n={}}s=t;if(e.is_array(t)){for(r=l=0,u=t.length;l<u;r=++l){o=t[r];if(!(o!=null)){s[r]=n[r]}}}else if(e.is_object(t)){for(i in t){a=t[i];if(!(a!=null)){s[i]=n[i]}}}else{throw"Defaults requires an iterable as the first param."}return s};this.first=function(e){var t;t=e.slice();return t.shift()};this.last=function(e){var t;t=e.slice();return t.pop()};this.purge=function(t){return e.filter(t,function(t){return e.is(t)})};this.empties=function(t){var n;n=[];_.each(t,function(t,r){if(!e.is(t)){n.push(r)}});return n};this.create_element_string=function(t,n,r,i){var s,o,a,l;if(r==null){r="*"}a=["area","base","basefont","br","col","frame","hr","img","input","link"];t=t.toLowerCase();s="<"+t;for(o in n){l=n[o];s+=" "+o+"="+'"'+(e.is_JSON(l)?e.JSON_to_safe(l):e.is_raw_object(l)||e.is_array(l)?e.JSON_to_safe(JSON.stringify(l)):l)+'"'}if(i!=null){s+=" "+i}s+=">";if(!e.in_array(a,t)){s+=r+"</"+t+">"}return s};this.create_doc_frag=function(e){var t,n,r,i,s,o;if(arguments.length>1){r="";for(s=0,o=arguments.length;s<o;s++){t=arguments[s];r+=t}}else{r=e}i=document.createRange();i.selectNode(document.getElementsByTagName("div").item(0));n=i.createContextualFragment(r);return n};this.to_doc_frag=function(e){var t;t=document.createDocumentFragment();t.appendChild(e);return t};this.add=function(t,n,r){var i,s,o;if(r==null){r=document.body}if(!(t!=null)||!e.is_object(n)){return false}i=e.debounce(function(t){var n,i,s,o,a,l;o=t;r=r;s=[];for(a=0,l=o.length;a<l;a++){n=o[a];s.push(e.create_element_string.apply(e,n))}i=e.create_doc_frag(s.join(""));return r.appendChild(i)},500,false);o=e.is_body(r)||!(r!=null)||!(s=r.getAttribute("id"))?"dom":s;if(!(e._state.queues[o]!=null)){e.internal.queues.create(o,{handler:i})}else if(!(e._state.handlers[o]!=null)){e.internal.queues.add_handler(o,i)}e.internal.queues.add(o,[t,n]);return e.internal.queues.process(o)};this.insert=function(e,t){return e.appendChild(t)};this.remove=function(e){return e.parentNode.removeChild(e)};this.get=function(t,n){var r,i,s,o,a;if(n==null){n=document}if(!(t!=null)||!e.type_of(t)==="string"){return false}if(t.nodeType){return t}if(e.is_array(t)){t=t[0]}if(n.setInterval!=null){n=document}if(e.in_array([".","#"],t[0])){a=[t.charAt(0),Array.prototype.slice.call(t,1).join("")],s=a[0],t=a[1];return s==="#"?document.getElementById(t):e.to_array(n.getElementsByClassName(t))}else{if((i=document.getElementById(t))!=null){return i}if((r=n.getElementsByClassName(t)).length>0){return r.length>1?e.to_array(r):r[0]}if((o=n.getElementsByTagName(t)).length>0){return o.length>1?e.to_array(o):o[0]}return null}};this.val=function(e,t){if(t!=null){if(e.value){e.value=t}else{e.innerText=t}return e}else{return e.value?e.value:e.innerText}};this.html=function(e,t){if(t!=null){e.innerHTML=t;return e}else{return e.innerHTML}};this.get_offset=function(e){var t,n;t=n=0;while(true){t+=e.offsetLeft;n+=e.offsetTop;if(!(e=e.offsetParent)){break}}return{left:t,top:n}};this.has_class=function(e,t){var n;return((n=e.classList)!=null?n.contains(t):void 0)||e.className&&new RegExp("\\s*"+t+"\\s*").test(e.className)};this.add_class=function(e,t){if(e.classList){e.classList.add(t)}else{e.className+=" "+t}return e};this.remove_class=function(e,t){if(e.classList){e.classList.remove(t)}else{e.className.replace(new RegExp("\\s*"+t+"\\s*")," ").replace(/\s{2}/g," ")}return e};this.is_id=function(e){if(e.charAt(0)==="#"){return true}if(document.getElementById(e)!==null){return true}return false};this.is_child=function(t,n){var r,i;r=false;if(e.is_array(n)){i=_.reject(_.map(n,function(n){return e.is_child(t,n)}),function(e){return e});r=i.length===0}else{while(n=n.parentNode){if(n!==t){continue}r=true;break}}return r};this.children=function(t){return e.to_array(t.childNodes)};this.find_parent=function(t,n){var r;return(r=e.filter([e.get(n)],function(n){return e.is_child(n,t)})[0])!=null?r:null};this.resolve_common_ancestor=function(t,n,r){var i,s,o,a;if(r==null){r=document.body}if(!e.is_child(r,[t,n])){throw"Bounding node must contain both search elements"}else{a=[];o=null;i=true;s=true;while(i||s){if(i){if(e.in_array(a,t)){o=t;break}else{a.push(t);i=t!==r&&(t=t.parentNode)&&t!=null}}if(s){if(e.in_array(a,n)){o=n;break}else{a.push(n);s=n!==r&&(n=n.parentNode)&&n!=null}}continue}return o}};this.bind=function(t,n,r,i){var s,o,a,l,u,c,f,p,h,d;if(i==null){i=false}if(!(t!=null)||!(n!=null)){return false}if(e.is_window(t)||t.nodeType||(s=e.is_array(t))&&t.length>0&&t[0].nodeType){if(e.is_raw_object(n)){for(l in n){u=n[l];t.addEventListener(l,u,i)}return}if(s){if(!e.is_array(n)){n=[n]}for(c=0,p=n.length;c<p;c++){a=n[c];for(f=0,h=t.length;f<h;f++){o=t[f];o.addEventListener(a,r,i)}}}else{return t.addEventListener(n,r,i)}}else{d=[t,n,r],n=d[0],r=d[1],i=d[2];return e.is_function(r)?$.apptools.events.hook(n,r,i):$.apptools.events.bridge(n,r,i)}};this.bridge=function(){return e.bind.apply(e,arguments)};this.trigger=function(){return $.apptools.events.trigger.apply($.apptools.events,arguments)};this.unbind=function(t,n){var r,i,s,o,a,l,u,c;if(!(t!=null)){return false}if(e.is_array(t)){for(a=0,u=t.length;a<u;a++){r=t[a];e.unbind(r,n)}}else if(e.is_array(n)){for(l=0,c=n.length;l<c;l++){i=n[l];e.unbind(t,i)}}else if(e.is_raw_object(t)){for(o in t){s=t[o];e.unbind(o,s)}}else if(t.constructor.name==="NodeList"){return e.unbind(e.to_array(t),n)}else{return t.removeEventListener(n)}};this.block=function(e,t){var n,r;if(t==null){t={}}console.log("[Util]","Enforcing blocking at user request... :(");r=false;n=null;e(t,function(e){n=e;return r=true});while(true){if(r!==false){break}}return n};this.defer=function(t,n){var r;if(!(n!=null)){return e.ready(t)}else if(parseInt(n).toString()==="NaN"){return false}else{r=setTimeout(t,n);return r}};this.ready=function(t){if(!(e._state.dom_status!=null)){e._state.dom_status="NOT_READY";e.bind("DOM_READY",e.ready);document.addEventListener("DOMContentLoaded",e._state.handlers.ready,false)}if(!(t!=null)&&e._state.dom_ready){return e.internal.queues.process("ready")}else if(e.is_function(t)){e.internal.queues.add("ready",t);if(document.readyState==="complete"&&e._state.dom_ready===true){return e.defer(e.ready,1)}else{}}};this.now=function(){return+new Date};this.timestamp=function(e){if(e==null){e=new Date}return[[e.getMonth()+1,e.getDate(),e.getFullYear()].join("-"),[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")].join(" ")};this.prep_animation=function(t,n,r){var i;i=!(t!=null)?{duration:400}:t!=null&&e.is_object(t)?e.extend({},t):{complete:r||!r&&n||e.is_function(t)&&t,duration:t,easing:r&&n||n&&!is_function(n)};return i};this.throttle=function(t,n,r){var i,s;if(r==null){r=false}s=null;i=0;return function(){var o,a,l,u;o=e.to_array(arguments);l=e.now()-i;a=function(){u();return s=null};u=function(){i=e.now();return t.apply(window,o)};if(r&&!s){u()}if(!!s){clearTimeout(s)}if(!r&&l>=n){return u()}else{return s=setTimeout(r?a:u,!r?n-l:n)}}};this.debounce=function(e,t,n){if(t==null){t=200}if(n==null){n=false}return this.throttle(e,t,n)};this.currency=function(e){var t,n,r,i,s,o,a,l;r=(s=String(e).split("").reverse()).length;i=[];o=function(e,t){var n;if((t+1)%3===0&&r-t>1){n=","}else if(t===r-1){n="$"}else{n=""}return i.unshift(n+e)};for(n=a=0,l=s.length;a<l;n=++a){t=s[n];o(t,n)}return i.join("")};this.extend=function(){var t,n,r,i,s,o,a,l,u,c,f,p,h,d,_,g;h=arguments[0]||{};a=1;o=false;u=arguments.length;if(e.type_of(h)==="boolean"){o=h;h=arguments[1]||{};a++}if(!e.is_object(h)&&!e.is_function(h)){h={}}r=Array.prototype.slice.call(arguments,a);for(_=0,g=r.length;_<g;_++){n=r[_];f=n;for(l in f){d=f[l];if(h===d){continue}c=String(l);i=d;p=h[l];if(o&&i!=null&&(e.is_raw_object(i)||(t=e.is_array(i)))){if(t){t=false;s=p&&(e.is_array(p)?p:[])}else{s=p&&(e.is_raw_object(p)?p:{})}h[l]=e.extend(o,s,i)}else if(i!=null){h[l]=i}}}return h};this["extends"]=function(e,t){var n,r;n={}.hasOwnProperty;for(r in t){if(n.call(t,r)){e[r]=t[r]}}return e};this.to_hex=function(t){var n,r,i,s;if(t.match(/^\#?[0-9a-fA-F]{6}|[0-9a-fA-F]{3}$/i)){if(t.charAt(0==="#")){return t}else{return"#"+t}}else if(t.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i)){r=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)];if(r.length===3){s=e.zero_fill(r[0].toString(16,2));i=e.zero_fill(r[1].toString(16,2));n=e.zero_fill(r[2].toString(16,2));return"#"+s+i+n}}else{return false}};this.to_rgb=function(e){var t,n,r,i;if(e.match(/^rgb\s*\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)\s*$/)){return e}else if(e.match(/^\#?([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})([0-9a-fA-F]{1,2})$/i)){n=[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)];i=n[0].toString(10);r=n[1].toString(10);t=n[2].toString(10);return"rgb("+i+","+r+","+t+")"}else{return false}};this.strip_script=function(e){var t;if(e.match(/^javascript:(\w\W.)/||e.match(/(\w\W.)\((.*)\)/))){t=RegExp.$1;console.log("Script stripped from link: ",t);return"javascript:void(0)"}else{return e}};this.type_of=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.wrap=function(){var t,n,r,i;r=1;n=arguments[0];i=false;if(e["typeof"](n)==="boolean"){i=n;n=arguments[1];r+=1}t=Array.prototype.slice.call(arguments,r);if(!i){return function(){return n.apply(this,t)}}else{return function(e){t.unshift(e);return n.apply(this,t)}}};this.zero_fill=function(e,t){if(t==null){t=8}return(Array(t).join("0")+e).slice(-t)};this.uuid=function(){var e;if(arguments[0]){e=String(arguments[0]);return btoa(e+"-"+(+new Date).toString(16))}else{return btoa((+new Date).toString(16))}};this.resolve_uuid=function(e,t){var n,r,i,s;n=atob(e);r=n.split("-");if(r.length>1){i=r[0];s=parseInt(r[1],16)}else{i="";s=parseInt(n,16)}if(t==="prefix"){return i}if(t==="timestamp"){return s}if(t==="date"){return Date(s)}else{return{prefix:i,timestamp:s}}};this.resolve_date=function(t){return e.resolve_uuid(t,"date")};this.resolve_prefix=function(t){return e.resolve_uuid(t,"prefix")};this.resolve_timestamp=function(t){return e.resolve_uuid(t,"timestamp")};this.init=function(){var t,n;t={find:function(e){return _.get(e,this)},getOffset:function(){return _.get_offset(this)},hasClass:function(e){return _.has_class(this,e)},addClass:function(e){return _.add_class(this,e)},removeClass:function(e){return _.remove_class(this,e)},isChild:function(e){return _.is_child(e,this)},isParent:function(e){return _.is_child(this,e)},children:function(){return _.children(this)},resolveAncestor:function(e,t){return _.resolve_common_ancestor(this,e,t)},bind:function(e,t,n){return _.bind(this,e,t,n)},unbind:function(e,t,n){return _.unbind(this,e,t,n)},append:function(e){return _.append(this,e)},remove:function(){return _.remove(this)},val:function(e){return _.val(this,e)},html:function(){return _.html(this)},fadeIn:function(){return HTMLElement.prototype.fadeInJacked.apply(this,arguments)},fadeOut:function(){return HTMLElement.prototype.fadeOutJacked.apply(this,arguments)},attr:function(e,t){return _.attr.call(_,this,e,t)},data:function(e,t){return _.data.call(_,this,e,t)}};e.extend(Element.prototype,t);if(HTMLElement.prototype!=null){e.extend(HTMLElement.prototype,t)}String.prototype.isJSON=function(){return _.is_JSON(this)};document.ready=function(){return _.ready.apply(_,arguments)};e._state.init=true;delete e._init;delete e.constructor;n=function(){if(arguments.length>0){return n.get.apply(n,arguments)}};e.extend(n,e);return n}}return e}();window.Util=ct;window._=(new ct).init();if(window.jQuery!=null){$.extend({_:window._})}else{window.$=window._}o=function(e){At(t,e);t.prototype.debug={strict:false,logging:true,eventlog:false,verbose:true,serverside:false};t.mount="dev";t.events=[];function t(e,n){var r,i,s,o=this;i=function(){var e;e=1<=arguments.length?St.call(arguments,0):[];return console.log.apply(console,e)};r=function(){var e;e=1<=arguments.length?St.call(arguments,0):[];return console.error.apply(console,e)};s=function(){var e;e=1<=arguments.length?St.call(arguments,0):[];return console.warn.apply(console,e)};this.eventlog=function(){var e,n,r,i;r=arguments[0],n=arguments[1],e=3<=arguments.length?St.call(arguments,2):[];if(t.prototype.debug.eventlog){if((i=r.toLowerCase())==="bridge"||i==="register"||i==="hook"){if(t.prototype.debug.verbose!==true){return}}o.log.apply(o,[["Events",r].join(":"),n].concat(St.call(e)))}};this.log=function(){var e,n,r;r=arguments[0],n=arguments[1],e=3<=arguments.length?St.call(arguments,2):[];if(!(e!=null)){e="{no context}"}if(t.prototype.debug.logging===true){i.apply(null,["["+r+"] INFO: "+n].concat(St.call(e)))}};this.warning=this.warn=function(){var e,n,r;r=arguments[0],n=arguments[1],e=3<=arguments.length?St.call(arguments,2):[];if(!(e!=null)){e="{no context}"}if(t.prototype.debug.logging===true){s.apply(null,["["+r+"] WARNING: "+n].concat(St.call(e)))}};this.error=function(){var e,n,i;i=arguments[0],n=arguments[1],e=3<=arguments.length?St.call(arguments,2):[];if(t.prototype.debug.logging===true){r.apply(null,["["+i+"] ERROR: "+n].concat(St.call(e)))}};this.verbose=function(){var e,n,r;r=arguments[0],n=arguments[1],e=3<=arguments.length?St.call(arguments,2):[];if(t.prototype.debug.verbose===true){i.apply(null,["["+r+"] DEBUG: "+n].concat(St.call(e)))}};this.exception=this.critical=function(){var e,t,r,s;s=arguments[0],r=arguments[1],t=arguments[2],e=4<=arguments.length?St.call(arguments,3):[];if(t==null){t=n.AppToolsException}i("A critical error or unhandled exception occurred.");i.apply(null,["["+s+"] CRITICAL: "+r].concat(St.call(e)));throw new t(s,r,e)};if(e.sys.state.config.devtools.debug===true){t.prototype.debug.logging=true;t.prototype.debug.verbose=true;if(e.sys.state.config.devtools.strict!=null){t.prototype.debug.strict=e.sys.state.config.devtools.strict}}}return t}(i);this.__apptools_preinit.abstract_base_classes.push(o);R=function(e){At(t,e);function t(e,t){this.source=e;this.message=t}t.prototype.toString=function(){return"["+this.source+"] ModelException: "+this.message};return t}(Error);f=function(e){At(t,e);t.mount="model";t.events=[];function t(){var e=this;this._state={init:false};this.put=function(t){return _.block(e.put_async,t)};this.get=function(t,n){return _.block(e.get_async,t,n)};this["delete"]=function(t,n){return _.block(e.delete_async,t,n)};this.put_async=function(t){if(t==null){t=function(e){return e}}return apptools.storage.put(e.constructor.prototype.name,t)};this.get_async=function(t,n){if(n==null){n=function(e){return e}}return apptools.storage.get(e.key,e.constructor.prototype.name,n)};this.delete_async=function(t){if(t==null){t=function(e){return e}}return apptools.storage["delete"](e.key,e.constructor.prototype.name,t)};this.all=function(e){if(!(e!=null)||!(ct!=null?ct.is_function(e):void 0)){if(e!=null){throw"Provided callback isn't a function. Whoops."}else{throw"all() requires a callback."}}else{throw"all() currently in active development, sorry."}};this.register=function(){return apptools.dev.verbose("CoreModelAPI","register() currently in active development, sorry.")};this._init=function(){this._state.init=true;return this}}return t}(i);I=function(){e.prototype.validate=function(e,t,n){var r,i,s,o,a=this;if(t==null){t=this.constructor.prototype.model}if(n==null){n=true}if(n){s=[];r=function(e,n){var r,i,o,a,l,u,c;if((c=t[e])!=null&&n!=null===(c!=null)){if(typeof c==="function"){i=new c;if(!i.validate(n)){return s.push({k:n})}}else if(c.constructor.name==="ListField"){o=new c[0];u=[];for(a=0,l=n.length;a<l;a++){r=n[a];if(o.validate(r)){continue}s.push({k:n});break}return u}else if(n.constructor.name!==c.constructor.name){return s.push({k:n})}}else{return s.push({k:n})}}}else{s={};r=function(e,n){var r,i,o,a,l;if((l=t[e])!=null&&n!=null===(l!=null)){if(typeof l==="function"){return s[e]=(new l).from_message(n)}else if(l.constructor.name==="ListField"){i=new E;for(o=0,a=n.length;o<a;o++){r=n[o];i.push((new l[0]).from_message(r))}return s[e]=i}else if(n.constructor.name===l.constructor.name){return s[e]=n}}}}for(i in e){if(!bt.call(e,i))continue;o=e[i];r(i,o)}if(!n){return s}return s.length===0};e.prototype.from_message=function(e,t){var n,r,i,s,o;if(e==null){e={}}if(t==null){t=false}r=this;o=r.validate(e);n=r.validate(e,null,false);if(t&&!o){console.log("Strict from_message() failed. Returning unmodified object.",r)}else if(_.is_empty_object(n)){console.log("No modelsafe properties found. Returning unmodified object.",r)}else{for(i in n){s=n[i];r[i]=s}}return r};e.prototype.to_message=function(e){var t,n,r,i,s,o,a,l;if(e==null){e=[]}r=this;n={};for(i in r){if(!bt.call(r,i))continue;s=r[i];if(typeof s!=="function"&&r.constructor.prototype.model[i]!=null){if(s.constructor.name==="ListField"){l=[];for(o=0,a=s.length;o<a;o++){t=s[o];l.push(t.to_message())}n[i]=l}else{n[i]=s}}}return n};function e(t){var n,r,i,s,o,a,l,u,c,f,p,h=this;if(_.is_raw_object(t)&&arguments.length===1){for(i in t){a=t[i];this[i]=a}}else{this.key=t}f=e.prototype;l=function(t){return h.prototype[t]=function(){return e.prototype[t].apply(h,arguments)}};for(u=0,c=f.length;u<c;u++){n=f[u];l(n)}if(this.constructor.mount!=null){r=this[this.constructor.mount];if(r!=null){p=r.constructor.prototype.model;for(i in p){o=p[i];if(o.constructor.name!=="ListField"){(function(e,t){h.__defineGetter__(t,function(){return e[t]});return h.__defineSetter__(t,function(){})})(r,i)}}}}if((s=this.constructor.prototype.template||this.constructor.template)!=null){this.template=new window.t(s)}return this}return e}();C=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.model={key:String()};return t}(I);E=function(e){At(t,e);function t(){var e,n=this;t.__super__.constructor.call(this);if(arguments.length>0){e=new t;e.push(arguments[0]);return e}this.pick=function(e,t){var n,r,i,s,o,a,l,u,c,f,p;if(parseInt(e).toString()!=="NaN"){o=e;l=this.length;if(t!=null){r=o-t;if(r>0){c=this.slice(0,t);f=c.join(this.slice(t).pick(r))}else{p=-r;c=this.slice(0,o);u=this.slice(o);while(r<0){u.pick(p);r++}f=c.join(u)}}else{s=this.slice(0,o);n=this.slice(o+1);f=this.slice(0,0).push(this[o]).join(s).join(n)}}else{a=e;if(!!~(i=_.indexOf(this,a))){return this.pick(i)}f=_.to_array(this);f.unshift(a)}this.empty();return this.join(f)};this.join=function(e){var t,n,r,i,s,o,a,l;if(e!=null&&(_.is_array(e)||(e.constructor.name=this.constructor.name))){for(s=0,a=e.length;s<a;s++){n=e[s];this.push(n)}return this}else{i="";r=this.length;for(t=o=0,l=this.length;o<l;t=++o){n=this[t];if(t===r-1){i+=n.toString()}i+=n.toString()+e}return i}};this.slice=function(e,t){var n,r;if(e==null){e=0}if(t==null){t=this.length}r=[];while(e<t){r.push(this[e]);e++}n=new this.constructor;return n.join(r)};this.push=function(e){var t;t=this.length;this[t]=e;this.length++;return this};this.empty=function(){this.length=0;return this};this.keys=function(){var e,t,n,r;t=[];for(n=0,r=this.length;n<r;n++){e=this[n];if(e!=null&&e.key!=null){t.push(e.key)}}return _.purge(t)};this.order=function(e,n){var r;if(n==null){n=false}r=(new t).join(this);this.empty();this.length=e.length;_.map(r,function(t,r,i){return this[_.indexOf(e)]=!!n?t[n]:t},this);return this};this.promote=function(e){var t,r;if(parseInt(e).toString()!=="NaN"){t=e}else{r=e;t=_.indexOf(n.keys(),r)}return n.pick(t,t-1)};this.demote=function(e){var t,r;if(parseInt(e).toString()!=="NaN"){t=e}else{r=e;t=_.indexOf(n.keys(),r)}return n.pick(t,t+1)};this.remove=function(e){var t,r,i,s;if(parseInt(e).toString()!=="NaN"){r=e}else{i=e;r=_.indexOf(n.keys(),i)}t=n.slice();s=t.slice(0,r).join(t.slice(r+1));n.empty();return n.join(s)};return this}return t}(Array);this.__apptools_preinit.abstract_base_classes.push(f,I,C,E);l=function(e){At(t,e);t.mount="events";t.events=[];function t(e,t){var n=this;this.registry=[];this.callchain={};this.history=[];this.mutators=[];this.fire=this.trigger=this.dispatch=function(){var t,r,i,s,o,a,l,u,c,f,p,h,d,_,g;i=arguments[0],t=2<=arguments.length?St.call(arguments,1):[];e.dev.eventlog("Trigger","Triggered event.",i,t,n.callchain[i]);if(wt.call(n.registry,i)>=0){l=0;a=0;s=[];f=[];f.push(i);g=n.callchain[i].hooks;for(p=0,d=g.length;p<d;p++){o=g[p];
try{if(o.once===true&&o.has_run===true){continue}else if(o.bridge===false){c=o.fn.apply(o,t);l++;n.history.push({event:i,callback:o,args:t,result:c});o.has_run=true}else if(o.bridge===true){s.push({event:o.event,args:t,mutator:o.mutator})}}catch(y){a++;u=n.history.push({event:i,callback:o,args:t,error:y});$.apptools.dev.eventlog("exception",'Encountered unhandled exception when dispatching event hook for "'+i+'".',n.history[u-1]);if($.apptools.dev.debug.eventlog&&$.apptools.dev.debug.verbose){$.apptools.dev.error("Events","Unhandled event hook exception.",y)}if($.apptools.dev.debug.strict){throw y}}}for(h=0,_=s.length;h<_;h++){r=s[h];f.push(r.event);if(r.mutator!==false){n.trigger.apply(n,[r.event].concat(St.call(n.mutators[r.mutator](r.args,i,r.event))))}else{n.trigger.apply(n,[r.event].concat(St.call(r.args)))}}return{events:f,executed:l,errors:a}}else{return false}};this.create=this.register=function(t){var r,i,s;if(!_.is_array(t)){if(_.is_string(t)&&t===""){return}t=[t]}else{if(t.length===0){return}}e.dev.eventlog("Register","Registered events.",{count:t.length,events:t});for(i=0,s=t.length;i<s;i++){r=t[i];n.registry.push(r);n.callchain[r]={hooks:[]}}return n};this.on=this.upon=this.when=this.hook=function(t,r,i){if(i==null){i=false}if(wt.call(n.registry,t)<0){e.dev.warning("warn","Tried to hook to unrecognized event. Registering...");n.register(t)}n.callchain[t].hooks.push({fn:r,once:i,has_run:false,bridge:false});e.dev.eventlog("Hook","Hook registered on event.",t);return true};this.delegate=this.bridge=function(t,r,i){var s,o,a,l,u,c;if(i==null){i=null}if(typeof r==="string"){r=[r]}if(typeof t==="string"){t=[t]}e.dev.eventlog("Bridge","Bridging events.",{from:t},"->",{to:r});c=[];for(l=0,u=t.length;l<u;l++){o=t[l];c.push(function(){var t,n,l;l=[];for(t=0,n=r.length;t<n;t++){a=r[t];if(!(this.callchain[o]!=null)){e.dev.warn("Events","Bridging from undefined source event:",o);this.register(o)}if(i!=null){s=this.mutators.push(i);l.push(this.callchain[o].hooks.push({event:a,bridge:true,mutator:s-1}))}else{l.push(this.callchain[o].hooks.push({event:a,bridge:true,mutator:false}))}}return l}.call(n))}return c}}return t}(i);this.__apptools_preinit.abstract_base_classes.push(l);s=function(e){At(t,e);t.mount="agent";t.events=["UA_DISCOVER"];function t(e,t){var n,r,i,s,o=this;this.platform={};this.fingerprint={};this.capabilities={};if(e.lib.modernizr!=null){this.capabilities=e.lib.modernizr}this.capabilities.simple={};n={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:t.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};i=function(e){var t,r,i;for(r=0,i=e.length;r<i;r++){t=e[r];if(t.string!=null){if(t.string.indexOf(t.subString)!==-1){n.versionSearchString=t.versionSearch||t.identity;return t.identity}}else if(t.prop){n.versionSearchString=t.versionSearch||t.identity;return t.identity}}};s=function(e){var t;t=e.indexOf(n.versionSearchString);if(t===-1){}else{return parseFloat(e.substring(t+n.versionSearchString.length+1))}};r=function(){var e,r,a,l,u;e=i(n.browsers)||"unknown";u=s(navigator.userAgent)||s(navigator.appVersion)||"unknown";a=i(n.os)||"unknown";if(e.search("iPod/iPhone")!==-1||e.search("Android")!==-1){l="mobile";r=true}else{l="desktop";r=false}o.platform={os:a,type:l,vendor:navigator.vendor,product:navigator.product,browser:e,version:u,flags:{online:navigator.onLine||true,mobile:r,webkit:/AppleWebKit\//.test(navigator.userAgent),msie:/MSIE/.test(navigator.userAgent),opera:/Opera/.test(navigator.userAgent),mozilla:/Firefox/.test(navigator.userAgent)}};o.capabilities.simple.cookies=navigator.cookieEnabled;if(t.XMLHttpRequest!=null){o.capabilities.simple.ajax=true}return{browser:[o.platform.browser,o.platform.version].join(":"),mobile:o.platform.flags.mobile,legacy:o.platform.flags.msie}};this.fingerprint=r();return this}return t}(i);this.__apptools_preinit.abstract_base_classes.push(s);this.StorageDriver=st=function(e){At(t,e);t.methods=["compatible","construct"];t["export"]="public";function t(){}return t}(c);this.compatible=function(){};this.construct=function(){};this.StorageAdapter=it=function(e){At(t,e);t.methods=["get","put","delete","clear","get_async","put_async","delete_async","clear_async"];t["export"]="public";function t(){return}return t}(c);this.KeyEncoder=T=function(e){At(t,e);t.methods=["build_key","encode_key","build_cluster","encode_cluster"];t["export"]="public";function t(){return}return t}(c);if(this.__apptools_preinit!=null){if(!(this.__apptools_preinit.abstract_base_classes!=null)){this.__apptools_preinit.abstract_base_classes=[]}if(!(this.__apptools_preinit.deferred_core_modules!=null)){this.__apptools_preinit.deferred_core_modules=[]}}else{this.__apptools_preinit={abstract_base_classes:[],deferred_core_modules:[]}}this.__apptools_preinit.detected_storage_engines=[];this.__apptools_preinit.abstract_base_classes.push(st,it);this.__apptools_preinit.abstract_feature_interfaces.push({adapter:st,name:"storage"});this.SimpleKeyEncoder=Q=function(e){At(t,e);function t(){var e=this;this.build_key=function(){};this.encode_key=function(){};this.build_cluster=function(){};this.encode_cluster=function(){}}return t}(T);mt=new Q;this.LocalStorageEngine=N=function(e){At(t,e);function t(e){var t=this;this.name=e;this._state={runtime:{count:{total_keys:0,by_kind:[]}}};this.get_async=function(e,n){var r;return n.call(r=t.get(e))};this.put_async=function(e,n,r){t.put(e,n);return r.call(n)};this.delete_async=function(e,n){t["delete"](e);return n.call(t)};this.clear_async=function(e){t.clear();return e.call(t)};this.get=function(e){return localStorage.getItem(e)};this.put=function(e,n){if(!(t.get(e)!=null)){t._state.runtime.count.total_keys++}return localStorage.setItem(e,n)};this["delete"]=function(e){t._state.runtime.count.total_keys--;return localStorage.removeItem(e)};this.clear=function(){t._state.runtime.count.total_keys=0;return localStorage.clear()};return}return t}(it);this.SessionStorageEngine=X=function(e){At(t,e);function t(e){var t=this;this.name=e;this._state={runtime:{count:{total_keys:0,by_kind:[]}}};this.get_async=function(e,n){var r;return n.call(r=t.get(e))};this.put_async=function(e,n,r){t.put(e,n);return r.call(n)};this.delete_async=function(e,n){t["delete"](e);return n.call(t)};this.clear_async=function(e){t.clear();return e.call(t)};this.get=function(e){return sessionStorage.getItem(e)};this.put=function(e,n){if(!(t.get(e)!=null)){t._state.runtime.count.total_keys++}return sessionStorage.setItem(e,n)};this["delete"]=function(e){t._state.runtime.count.total_keys--;return sessionStorage.removeItem(e)};this.clear=function(){t._state.runtime.count.total_keys=0;return sessionStorage.clear()};return}return t}(it);this.LocalStorageDriver=k=function(e){At(t,e);function t(){var e=this;this._state={};this.compatible=function(){return!!window.localStorage};this.construct=function(t){var n;if(t==null){t="appstorage"}if(e.compatible()){return n=new N(t)}else{return false}};return}return t}(st);this.SessionStorageDriver=J=function(e){At(t,e);function t(){var e=this;this._state={};this.compatible=function(){return!!window.sessionStorage};this.construct=function(t){var n;if(t==null){t="appstorage"}if(e.compatible()){return n=new X(t)}else{return false}};return}return t}(st);this.__apptools_preinit.detected_storage_engines.push({name:"LocalStorage",adapter:N,driver:k,key_encoder:mt});this.__apptools_preinit.detected_storage_engines.push({name:"SessionStorage",adapter:X,driver:J,key_encoder:mt});this.__apptools_preinit.abstract_base_classes.push(Q,N,X,N,J);this.CoreStorageAPI=y=function(e){At(t,e);t.mount="storage";t.events=["STORAGE_INIT","ENGINE_LOADED","STORAGE_READY","STORAGE_ERROR","STORAGE_ACTIVITY","STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE","COLLECTION_SCAN","COLLECTION_CREATE","COLLECTION_DESTROY","COLLECTION_UPDATE","COLLECTION_SYNC"];function t(e,t){var n=this;this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:false,autosync:{enabled:false,interval:120},drivers:[],engines:{},encrypt:false,integrity:false,obfuscate:false,local_only:false,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}};this.internal={check_support:function(e){},bootstrap:function(e){},provision_collection:function(e,t,n){},add_storage_engine:function(t,r,i){var s,o;try{s=new r(e);o=new i(e)}catch(a){return false}if(o.compatible()){n._state.config.engines[t]=o;r.adapter=n._state.config.engines[t];n._state.config.drivers.push(r);e.sys.drivers.install("storage",t,s,s.enabled!=null|true,s.priority!=null|50,function(t){return e.events.trigger("ENGINE_LOADED",{driver:t,engine:t.adapter})});return true}else{e.dev.verbose("StorageEngine","Detected incompatible storage engine. Skipping.",t,r,i);return false}}};this.get=function(){};this.list=function(){};this.count=function(){};this.put=function(){};this.query=function(){};this["delete"]=function(){};this.sync=function(){};this._init=function(){var t,r,i,s,o,a;e.events.trigger("STORAGE_INIT");e.dev.verbose("Storage","Storage support is currently under construction.");if(((s=e.sys)!=null?(o=s.preinit)!=null?o.detected_storage_engines:void 0:void 0)!=null){a=e.sys.preinit.detected_storage_engines;for(r=0,i=a.length;r<i;r++){t=a[r];n.internal.add_storage_engine(t.name,t.driver,t.adapter)}}return e.events.trigger("STORAGE_READY")};e.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY");e.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return t}(i);this.__apptools_preinit.abstract_base_classes.push(y);this.__apptools_preinit.deferred_core_modules.push({module:y});this.TransportInterface=ut=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="transport";t.prototype.required=[];return t}(w);this.RPCInterface=M=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="rpc";t.prototype.parent=ut;t.prototype.required=["factory","fulfill"];t.prototype.factory=function(){};t.prototype.fulfill=function(){};return t}(ut);this.SocketInterface=et=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="socket";t.prototype.parent=ut;t.prototype.required=["factory","open","send","close","message"];t.prototype.open=function(){};t.prototype.send=function(){};t.prototype.close=function(){};t.prototype.factory=function(){};t.prototype.message=function(){};return t}(ut);this.NativeXHR=x=function(e){At(t,e);t.prototype.xhr=null;t.prototype.request=null;t.prototype.headers={};t.prototype.events={};function t(e,t){var n=this;this.xhr=e;this.request=t;this.open=function(e,t,r){return n.xhr.open(e,t,r)};this.get_header=function(e){return n.headers[e]};this.set_header=function(e,t){return n.headers[e]=t};this.send=function(e){var t,r,i,s,o,a;o=n.headers;for(r in o){s=o[r];n.xhr.setRequestHeader(r,s)}a=n.events;for(i in a){t=a[i];n.xhr[i]=t}return n.xhr.send(e)};return this}return t}(p);this.SocketState=nt=function(e){var t,n,r,i;At(s,e);function s(){return s.__super__.constructor.apply(this,arguments)}t=1;r=2;i=3;n=4;return s}(p);this.SocketCommands=Z=function(e){var t,n,r,i,s,o,a,l,u,c,f,p,h,d;At(_,e);function _(){return _.__super__.constructor.apply(this,arguments)}a=0;l=1;s=2;n=3;i=4;d=5;h=6;r=7;t=8;o=9;c=10;f=11;u=12;p=13;return _}(p);this.NativeSocket=L=function(e){At(t,e);t.prototype.id=0;t.prototype.uuid=null;t.prototype.name=null;t.prototype.host=null;t.prototype.state=nt.CLOSED;t.prototype.config={};t.prototype.events={};t.prototype.socket=null;t.prototype.request=null;t.prototype.protocols=[];function t(e,t,n){var r,i=this;this.config=e;this.events=t!=null?t:{};this.socket=n!=null?n:WebSocket;this.transmit=Tt(this.transmit,this);this.get_header=Tt(this.get_header,this);this.set_header=Tt(this.set_header,this);this.serialize=Tt(this.serialize,this);this.send=Tt(this.send,this);this.close=Tt(this.close,this);this.open=Tt(this.open,this);r={open:function(e){i.internal.state(nt.OPEN);if(i.events.open!=null){return i.events.open(e,i.socket)}},error:function(e){i.internal.state(nt.ERROR);if(i.events.error!=null){return i.events.error(e,i.socket)}},message:function(e){if(i.events.message!=null){return i.events.message(e.data,e,i.socket)}},close:function(e){i.internal.state(nt.CLOSED);if(i.events.close!=null){return i.events.close(e,i.socket)}}};this.internal={bind:function(){i.socket.onopen=r.open;i.socket.onclose=r.close;i.socket.onmessage=r.message;i.socket.onerror=r.error;return i},send:function(){var e,t;e=1<=arguments.length?St.call(arguments,0):[];return(t=i.socket).send.apply(t,e)},state:function(e){return i.state=e}}}t.prototype.protocols=[];t.prototype.add_protocol=function(e){var t,n,r,i;i=this.protocols;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.name===e.name){$.apptools.dev.warning("fcm:socket","Re-registered protocol.",e);return this}}this.protocols.unshift(e);return this};t.prototype.list_protocols=function(){return this.protocols};t.prototype.remove_protocols=function(e){var t,n,r,i,s,o;n=null;o=this.protocols;for(t=i=0,s=o.length;i<s;t=++i){r=o[t];if(r.name===e){n=t;break}}delete this.protocols[t];return this};t.prototype.open=function(e){var t,n,r;if(e==null){e=null}if(!(e!=null)&&!this.config.host&&!(this.config.endpoint!=null)){throw"Must provide a host or socket URL."}else{if(e!=null){n=this.socket=new this.socket(e,function(){var e,n,r,i;r=this.protocols;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.name)}return i}.call(this))}else{if(this.config.endpoint!=null){n=this.socket=new this.socket(this.config.endpoint,function(){var e,n,r,i;r=this.protocols;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.name)}return i}.call(this))}else{if(this.config.secure!=null){r=this.config.secure?"wss":"ws"}else{r="ws"}n=this.socket=new this.socket([r,this.config.host].join("://"),function(){var e,n,r,i;r=this.protocols;i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.name)}return i}.call(this))}}this.internal.bind();return this}};t.prototype.establish=t.prototype.open;t.prototype.close=function(e){if(e==null){e=true}if(e){return this.send(Z.CLOSE)}else{return this.socket.close()}};t.prototype.destroy=t.prototype.open;t.prototype.send=function(e,t){if(t==null){t=null}if(typeof e==="number"){return this.transmit(this.serialize(e,t))}else{if(!(t!=null)){return this.transmit(e)}else{return this.transmit(this.serialize(Z[e],t))}}};t.prototype.serialize=function(e,t){var n,r,i,s,o;if(t==null){t=null}if(!_.is_array(e)){e=[e]}if(!_.is_array(t)){t=[t]}r=[];for(i=s=0,o=e.length;s<o;i=++s){n=e[i];switch(n){case Z.PING:r.push(0);break;case Z.PONG:r.push(1);break;case Z.INIT:r.push(this.identify());break;case Z.REQUEST:r.push(t[i].payload());break;default:r.push(t[i])}}return r};t.prototype.set_header=function(e,t){this.config.headers[e]=t;return this};t.prototype.get_header=function(e){if(this.config.headers[e]!=null){return this.config.headers[e]}else{return false}};t.prototype.transmit=function(e){var t;t={id:this.id++,headers:{},request:e};this.payload.headers=_.extend({},this.payload.headers,this.config.headers);return this.internal.send(JSON.stringify(t))};return t}(p);this.SocketVocabulary=rt=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(p);this.SocketProtocol=tt=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.name="APTLS_V1";t.state=nt;t.commands=Z;t.vocabulary=rt;t.prototype.install=function(e,t){e.__apptools_preinit.abstract_base_classes.push(t);e.NativeSocket.prototype.add_protocol(t);return t};t.prototype.get_command=function(e){var t,n,r;r=this.commands;for(t in r){n=r[t];if(e===n){return t}}};t.prototype.pack=function(e,t){return this.encode(this.serialize(e,t))};t.prototype.unpack=function(e){return this.deserialize(this.decode(e))};return t}(p);this.RPCPromise=F=function(e){At(t,e);t.prototype.expected=null;t.prototype.directive=null;t.prototype.fulfilled=false;function t(e,t){this.expected=e;this.directive=t;return this}t.prototype.value=function(e,t){if(e==null){e=true}if(t==null){t=false}if(directive.status!=="constructed"){if(directive.status==="pending"){while(true){if(directive.status!=="pending"){break}}return directive.response}else{return this.directive.response}}else{return this.directive.request.fulfill()}};return t}(p);this.ServiceLayerDriver=B=function(e){At(t,e);t.prototype.name="apptools";t.prototype["native"]=true;t.prototype["interface"]=[M];function t(e){var n=this;this.internal={status_codes:{errors:[400,401,403,404,405,406,500,501,502,503,504,505],success:[200,201,202,203,204,205,303,304,301,302,307,308]},endpoint:function(e){}};this.rpc={factory:function(e){return new x(new XMLHttpRequest,e)},fulfill:function(t,r,i){var s,o,a,l,u,c;t.open(r.context.http_method,r.endpoint(e.rpc.state.config.jsonrpc),r.context.async);c=_.extend({"Content-Type":r.context.content_type},e.rpc.state.config.headers,r.context.headers);for(a in c){u=c[a];t.set_header(a,u)}s=function(e,t){var r;try{if(!(!(t.target.response!=null)||!_.is_string(t.target.response)||t.target.response.length<0)){r=JSON.parse(t.target.response)}}catch(s){r=t.target.response}if(_.in_array(n.internal.status_codes.errors,t.target.status)){return i("failure",r)}return i(r.status,r)};l=t.events.onload=function(e){return s("success",e)};o=t.events.onerror=t.events.onabort=t.events.timeout=function(e){return s("failure",e)};return t.send(JSON.stringify(r.payload()))}};return t.__super__.constructor.call(this,e)}return t}(b);this.RealtimeDriver=z=function(e){At(t,e);t.prototype.name="apptools";t.prototype["native"]=true;t.prototype["interface"]=[et];function t(e){var t=this;this.internal={impl:L,state:nt,config:e.sys.state.config.transport.sockets};this.rpc={factory:function(e){return t.internal.acquire(e)},fulfill:function(e,n,r){return t.rpc.factory()},open:function(){},send:function(){},close:function(){},message:function(){}}}return t}(b);this.RPCContext=P=function(e){At(t,e);t.prototype.model={url:String(),async:Boolean(),defer:Boolean(),headers:Object(),cacheable:Boolean(),http_method:String(),crossdomain:Boolean(),content_type:String(),ifmodified:Boolean(),base_uri:String()};t.prototype.defaults={async:true,defer:false,headers:{},cacheable:false,http_method:"POST",crossdomain:false,content_type:"application/json",ifmodified:false};function t(e){if(e==null){e={}}_.extend(this,this.defaults,e)}return t}(I);this.RPCEnvelope=D=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(I);this.RequestEnvelope=K=function(e){At(t,e);t.prototype.model={id:Number(),opts:Object(),agent:Object()};function t(e){_.extend(this,e)}return t}(D);this.ResponseEnvelope=W=function(e){At(t,e);t.prototype.model={id:Number(),flags:Object(),platform:Object()};function t(e){t.__super__.constructor.call(this,_.extend(this,e))}return t}(D);this.RPC=q=function(e){At(t,e);t.prototype.model={ttl:Number(),context:P,envelope:D};function t(){this.state=Tt(this.state,this);return this.state("constructed")}t.prototype.expired=function(){return true};t.prototype.state=function(e){if(!(this.flags!=null)){this.flags={}}this.flags.state=e;return this};return t}(I);this.RPCRequest=G=function(e){At(t,e);t.prototype.states=["constructed","pending","fulfilled"];t.prototype.model={state:String(),params:Object(),method:String(),service:String()};function t(e){this.payload=Tt(this.payload,this);this.fingerprint=Tt(this.fingerprint,this);t.__super__.constructor.call(this,_.extend(this,e))}t.prototype.fulfill=function(e){if(e==null){e={}}return $.apptools.rpc.request.fulfill(this,e)};t.prototype.defer=function(e){return this.flags.defer=e};t.prototype.fingerprint=function(){return window.btoa(JSON.stringify([this.service,this.method,this.params,this.envelope.opts]))};t.prototype.endpoint=function(e){var t,n;if(e==null){e={}}if(!(this.context.url!=null)){if(!(e.host!=null)){t=[window.location.protocol,window.location.host].join("//")}else{t=e.host}if(this.context.base_uri!=null&&_.is_string(this.context.base_uri)){n=this.context.base_uri}else{n=e.base_uri}return[[t.concat(n),this.service].join("/"),this.method].join(".")}return this.context.url};t.prototype.payload=function(){return{id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.service}}};return t}(q);this.RPCResponse=U=function(e){At(t,e);t.prototype.states=["constructed","pending","success","failure","wait"];t.prototype.model={type:String(),status:String(),payload:Object()};t.prototype.events={success:null,failure:null};function t(e){this.inflate=Tt(this.inflate,this);t.__super__.constructor.call(this,_.extend(this,e))}t.prototype.inflate=function(e){return _.extend(this,e)};t.prototype.callbacks=function(e){this.events=e;return this};return t}(q);this.RPCErrorResponse=Y=function(e){At(t,e);t.prototype.model={code:Number(),message:String()};function t(e,t){var n;this.events=e.events;if(!(((n=t.response)!=null?n.content:void 0)!=null)){$.apptools.dev.error("RPC","Invalid RPC error structure.",e,t);throw"Invalid RPC error structure."}return this.inflate(t)}return t}(U);this.RPCAPI=j=function(e){At(t,e);function t(e,t,n,r){var i,s,o,a;s=function(e,t,n,r){var i=this;return function(n,i,s,o,a){if(n==null){n={}}if(i==null){i={}}if(s==null){s={}}if(o==null){o={}}if(a==null){a=G}return function(n,i,s,o){return r.rpc.request.factory({method:t,service:e,params:n||{},context:new P(_.extend(r.rpc.request.context["default"](),i)),envelope:new K(_.extend(o,{id:r.rpc.request.provision(),opts:s||{},agent:r.agent.fingerprint}))},a)}(n,i,s,o)}};if(!(!(t.length!=null)||t.length===0)){for(o=0,a=t.length;o<a;o++){i=t[o];this[i]=s(e,i,n,r)}}r.rpc.service.register(this,t,n);return this}return t}(p);this.CoreRPCAPI=h=function(e){At(n,e);n.mount="rpc";n.events=["RPC_CREATE","RPC_FULFILL","RPC_SUCCESS","RPC_FAILURE","RPC_COMPLETE","RPC_PROGRESS"];function n(e,n){var r=this;this.state={config:{jsonrpc:{host:null,enabled:true,base_uri:"/_api/rpc",default_ttl:null,driver:null},channel:{token:null,script:null,enabled:false,status:"DISCONNECTED",default_ttl:null,driver:null},sockets:{host:null,token:null,enabled:false,status:"DISCONNECTED",default_ttl:null,driver:null},headers:{"X-ServiceClient":["AppToolsJS/",t.version.get()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}},consumer:null,requestpool:{id:1,data:[],index:[],done:[],queue:[],error:[],expect:{},context:new P},servicepool:{name_i:{},rpc_apis:[]},history:{last_request:null,last_error:null,last_success:null,rpclog:[]},cache:{data:{},index:{}}};this.internals={validate:function(e){return e},respond:function(t,n){var i;if(n==null){n=false}e.events.trigger("RPC_FULFILL",t);if(n){if(t.request.cacheable!=null&&t.request.cacheable===true){try{if((i=r.state.cache.data[r.state.cache.index[t.request.fingerprint()]])!=null&&!i.expired()){return r.internals.validate(i)}}catch(s){}}}return[r.internals.expect(t,n),r.internals.send_rpc(t)]},expect:function(t,n){t.status="pending";t.request.state("pending");t.response.state("pending");return new F(t,r.state.requestpool.expect[r.state.requestpool.index[t.request.envelope.id]]={success:function(i){t.status="success";t.request.state("fulfilled");t.response.state("success");r.state.requestpool.done.push(r.state.requestpool.index[t.request.envelope.id]);r.state.requestpool.queue.splice(t.queue_i,t.queue_i);delete r.state.requestpool.expect[r.state.requestpool.index[t.request.envelope.id]];if(n){r.response.store(t.request,t.response)}e.events.dispatch("RPC_SUCCESS",t);t.response.events.success(i.response.content,i.response.type,i)},failure:function(n){t.status="failure";t.response.state("failure");t.request.state("fulfilled");r.state.requestpool.error.push(r.state.requestpool.index[t.request.envelope.id]);r.state.requestpool.queue.splice(t.queue_i,t.queue_i);delete r.state.requestpool.expect[r.state.requestpool.index[t.request.envelope.id]];e.events.dispatch("RPC_FAILURE",t);t.response.events.failure(n.response.content,n.response.type,n)},progress:function(n){var r;e.events.dispatch("RPC_PROGRESS",t);if(typeof(r=t.response.events).progress==="function"){r.progress(t.request,n,t)}}})},send_rpc:function(t){var n,i,s,o;n=(o=r.state.config.jsonrpc).driver||(o.driver=e.sys.drivers.resolve(M));if(!(n!=null)){e.dev.error("RPC","Failed to resolve RPC-compatible driver for prompted RPC directive.",n,t);throw"Failed to resolve RPC-compatible driver prompted RPC directive."}i=t.queue_i=r.state.requestpool.queue.push(r.state.requestpool.index[t.request.envelope.id])-1;s=t.xhr=n.rpc.factory(t.request);e.events.dispatch("RPC_FULFILL",t.request,t.xhr,t);n.rpc.fulfill(t.xhr,t.request,function(e,n){return r.response.dispatch(e,t,n)});return t},dispatch:function(t,n){if(!(r.state.requestpool.expect[r.state.requestpool.index[t.request.envelope.id]]!=null)){e.dev.error("RPC","Received a request to dispatch an unexpected RPC response.",t);throw"Unexpected RPC response.";return r}return r.state.requestpool.expect[r.state.requestpool.index[t.request.envelope.id]][t.response.status](t.response,t.response.type,n)}};this.request={provision:function(){return r.state.requestpool.id++},factory:function(t,n){var i,s;if(n==null){n=G}s=new n(t);i=r.state.requestpool.index[s.envelope.id]=r.state.requestpool.data.push({request:s,response:new U({id:s.envelope.id}),status:"constructed"})-1;e.events.dispatch("RPC_CREATE",t,s,i);return s},fulfill:function(e,t,n){if(t==null){t={}}if(n==null){n=false}r.state.requestpool.data[r.state.requestpool.index[e.envelope.id]].response.callbacks(_.extend(r.response.callbacks["default"],t));return r.internals.respond(r.state.requestpool.data[r.state.requestpool.index[e.envelope.id]],n)},context:{"default":function(e){if(!!(e!=null)){r.state.requestpool.context=e}return r.state.requestpool.context},factory:function(){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(P,arguments,function(){})}}};this.response={store:function(e,t){return r},notify:function(e,t,n){},dispatch:function(e,t,n){if(e==="failure"){t.response=new Y(t.response,n)}if(e!=="failure"){t.response.inflate(n)}return r.internals.dispatch(t,n)},callbacks:{"default":{notify:function(t){return e.dev.verbose("RPC","Encountered notify RPC with no callback.",t)},success:function(t){return e.dev.verbose("RPC","Encountered successful RPC with no callback.",t)},failure:function(t){return e.dev.verbose("RPC","Encountered failing RPC with no error callback.",t)}}}};this.direct={notify:function(e){},request:function(e){},response:function(e){},subscribe:function(e){},broadcast:function(e){}};this.service={factory:function(t,n,i,s){var o,a,l,u;if(!_.is_array(t)){t=[t]}for(l=0,u=t.length;l<u;l++){o=t[l];a=o[0],i=o[1],s=o[2];r.state.servicepool.name_i[a]=r.state.servicepool.rpc_apis.push(new j(a,i,s,e))-1;e.api[a]=r.state.servicepool.rpc_apis[r.state.servicepool.name_i[a]]}return r},register:function(t,n,r){return e.events.dispatch("CONSTRUCT_SERVICE",t,n,r)}}}return n}(i);this.CoreServicesAPI=g=function(e){At(t,e);t.mount="api";t.events=["SERVICES_INIT","CONSTRUCT_SERVICE"];function t(e,t){var n=this;this._init=function(e){var t;if(e.sys.state.config!=null&&((t=e.sys.state.config)!=null?t.services:void 0)!=null){if(e.sys.state.config.services.endpoint!=null){e.rpc.state.config.jsonrpc.host=e.sys.state.config.services.endpoint}if(e.sys.state.config.services.consumer!=null){e.rpc.state.config.consumer=e.sys.state.config.services.consumer}e.events.dispatch("SERVICES_INIT",e.rpc.state.config);e.rpc.service.factory(e.sys.state.config.services.apis);e.dev.verbose("RPC","Autoloaded in-page RPC config.",e.sys.state.config.services)}}}return t}(i);vt=[ut,M,et,L,tt,x,F,B];for(_t=0,yt=vt.length;_t<yt;_t++){pt=vt[_t];pt.prototype.install(window,pt)}this.__apptools_preinit.abstract_base_classes.push(h);this.__apptools_preinit.abstract_base_classes.push(g);v=function(e){At(t,e);t.mount="user";t.events=["SET_USER_INFO"];function t(e,t){var n=this;this.current_user=null;this.authenticated=false;this.permissions={};this._init=function(e){var t;if(e.sys.state.config!=null&&((t=e.sys.state.config)!=null?t.user:void 0)!=null){if(e.sys.state.config.user!==false){n.setUserInfo(true,e.sys.state.config.user,e.sys.state.config.permissions)}else{n.setUserInfo(false)}}};this.setUserInfo=function(t,r,i){if(t){n.authenticated=true;n.current_user=r;n.permissions=i;e.dev.log("User","Set server-injected userinfo: ",{authenticated:t,user:r,permissions:i});e.events.trigger("SET_USER_INFO",r,t,i)}else{n.authenticated=false;n.current_user=null;n.permissions={};e.dev.log("User","Server indicated that no user is currently logged in.");e.events.trigger("SET_USER_INFO",null,false,{})}}}return t}(i);this.__apptools_preinit.abstract_base_classes.push(v);m=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="dom";t.prototype.required=[];return t}(w);O=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="query";t.prototype.parent=m;t.prototype.required=["element_by_id","elements_by_class","elements_by_tag","get"];t.prototype.get=function(e){};t.prototype.element_by_id=function(e){};t.prototype.elements_by_tag=function(e){};t.prototype.elements_by_class=function(e){};return t}(w);V=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="render";t.prototype.parent=m;t.prototype.required=[];t.prototype.render=function(e,t){};return t}(w);e=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.capability="animation";t.prototype.parent=m;t.prototype.required=["animate"];t.prototype.animate=function(e,t){};return t}(w);d=function(e){At(t,e);t.mount="render";t.events=[];t["export"]="private";function t(e,t){return this}return t}(i);H=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(u);ot=function(){var e,t,n,r,i;s["export"]="public";s.idx=0;s.uuid=function(){this.idx++;return _.zero_fill(this.idx,3)};e=/\{\{\s*?(([@!>]?)(.+?))\s*?\}\}(([\s\S]+?)(\{\{\s*?:\1\s*?\}\}([\s\S]+?))?)\{\{\s*?\/(?:\1|\s*?\3\s*?)\s*?\}\}/g;r=/\{\{\s*?([<&=%\+])\s*?(.+?)\s*?\}\}/g;n=/\{\{[\w\W.]*\}\}/;t=/function\s?(\w*)\s?\(([\w\W.]*)\)\s?\{([\w\W.]*)\}/;i=/[\r\n\t]*/g;function s(e,t,n){var r=this;if(t==null){t=false}this.t=e.replace(i,"");this.name=n!=null?n:"template_"+s.uuid();this.temp=[];this.compile=function(){return s.prototype.compile.apply(r,arguments)};this.bind=function(){return s.prototype.bind.apply(r,arguments)};return!!t?t.nodeType?this.compile(this.bind(t)):this.compile(this):this}s.prototype.bind=function(e){delete this.bind;this.node=e;this.env=document.createElement(this.node.tagName);
return this};s.prototype.compile=function(t,i,s){var o,a,l,u,c,f,p,h=this;if(i==null){i="str"}if(s==null){s="ctx"}c=t.name;p=t.t;f=c+".node";console.log("[Render]","Compiling AppTools JS template:",c);a=0;u=function(t){var o,l,f,p,d,_,g;o="";l=a>0?"_val":s;d=t.match(n);d=!!d?d[0]:t;_=d;p=!!~t.search(n)?t.search(n):t.length;if(p===-1||p===d.length){p=0}g=h.safe(t.slice(0,p));f=h.safe(t.slice(d.length+p));o+="'";if(g.length>0){o+=g}if(e.test(d)){_=_.replace(e,function(e,t,n,r,o,c,p,h){var d,_,y,v,m;v=g.length>0?"';":"";d=[l,r].join(".");if(n===""||!n){v+="if(!!"+d+"){"+i+"+="+u(c);if(p){v+="}else{"+i+"+="+u(h)}}else if(n==="!"){v+="if(!"+d+"){"+i+"+="+u(o)}else if(n==="@"||n===">"){_="_"+r.slice(0,2)+r.slice(r.length-2);y="_"+_;m=_+"["+y+"]";if(n===">"){a++}v+="var "+_+"="+d+";for(var "+y+" in "+_+"){";v+=n==="@"?s+"._key="+y+";"+s+"._val="+m:"_val="+m;v+=";"+i+"+=";v+=u(o);if(n===">"){v+=";_val=null;";a--}}v+="}";if(f.length>0){v+=i+"+='"}return v})}if(r.test(_)){_=_.replace(r,function(e,t,n){var r;if(t==="+"){r="this."+n+"(false,"+l+")"}else if(t==="&"){n=parseInt(n);if(String(n)!=="NaN"){r=c+".temp["+(n-1)+"]"}}else{r=[l,n].join(".")}return"'+"+(t==="%"?"Template.prototype.scrub("+r+")":t==="<"?"("+c+".temp.push("+r+"),"+r+")":r)+"+'"})}o+=_;o+="'";if(f.length>0){o+="+'"+f+"'"}return o};o=[c+" = (function() {",c+".name = '"+c+"';","function "+c+" ("+s+") {","var _val,n="+f+",","dom=(typeof "+s+"=='boolean')?","(c = "+s+", "+s+" = arguments[1], c)",":true;var "+i+"=",u(p),";return ("+c+".temp=[], (dom && n != null)?","n.outerHTML="+i,":"+i+");}","return "+c+";}).call(this);","return "+c+";"].join("");l=new Function("",o)();if(t.env!=null){l.node=t.node}else{l.bind=function(e){this.node=e;delete this.bind;return this.node}}console.log("[Render]","Template compiled:",String(l).replace(/\{[\w\W.]*\}/,"{...}"));return l};s.prototype.parse=function(t,n){var i=this;if(!(n!=null)){n=t;t=this.t}if(n._ctx){n=n._ctx}if(n.tag&&n.attrs){return _create_element_string(n.tag,n.attrs,n.separator)}else{return t.replace(e,function(e,t,r,s,o,a,l,u){var c,f,p,h,d,_,g;d=i.get_value(n,s);p="";if(!d){return r==="!"?i.parse(o,n):l?i.parse(u,n):""}if(!r){return i.parse(l?a:o,n)}if(r==="@"){for(f in d){h=d[f];if(d.hasOwnProperty(f)){p+=i.parse(o,{_key:f,_val:h})}}}if(r===">"){if(Array.isArray(d)||d.constructor.name==="ListField"){for(_=0,g=d.length;_<g;_++){c=d[_];p+=i.parse(o,{_ctx:c})}}else{p+=i.parse(o,{_ctx:d})}}return p}).replace(r,function(e,t,r){var s,o;if(t==="&"){return i.temp[parseInt(r)-1]}if(t==="+"){s=new Function("","return this."+r+";")();return s(n)}o=i.get_value(n,r);if(t==="<"){i.temp.push(o)}return o!=null?t==="%"?i.scrub(o):o:""})}};s.prototype.unparse=function(e){var t,n,r,i,s,o,a;r={attributes:{}};i=e.parentNode;n=0;r.tagName=e.tagName;a=e.attributes;for(s=0,o=a.length;s<o;s++){t=a[s];r.attributes[t.name]=t.nodeValue}r.innerHTML=e.innerHTML;if(!i.hasAttribute("id")){while(n++,i=i.parentNode){if(!i.hasAttribute("id")){continue}break}}r.parent=i.getAttribute("id");r.depth=n;return r};s.prototype.scrub=function(e){return new Option(e).innerHTML.split("'").join("&#39;").split('"').join("&quot;")};s.prototype.safe=function(e){return e.split("'").join("&#39;")};s.prototype.get_value=function(e,t){var n;n=t.split(".");while(n.length){if(!(n[0]in e)){return false}e=e[n.shift()]}return typeof e==="function"?e():e};s.prototype.template=function(e){this.t=e;return this};s.prototype.render=function(e){var t,n,r,i;n=typeof e==="boolean"?(t=e,e=arguments[1],t):true;if(!(e!=null)){return false}r=this.parse(e);if(!n||!(this.env!=null)){return r}this.env.appendChild(this.node.cloneNode(false));this.env.firstChild.outerHTML=r;i=this.env.firstChild;if(n){this.node.parentNode.insertBefore(i,this.node)}this.node=i;return this.node};return s}();window.t=ot;lt=function(){function e(){var e=this;this.load=function(t){console.log(e.constructor.name,"Loading templates from a remote service is currently stubbed.");return t};return this}return e}();at=function(e){At(t,e);t.mount="templates";t.events=[];t["export"]="private";function t(e,t){var n=this;this._state={data:[],index:{},count:0,init:false};this._init=function(){var e,r,i,s,o,a;n.outerHTML=function(e,t){var n,r;n=document.createElement("div");n.appendChild(this.cloneNode(false));n.firstChild.outerHTML=e;r=n.firstChild;this.parentNode.insertBefore(r,this);t.cache.push(this.parentNode.removeChild(this));t.node=r;t.node.__defineSetter__("outerHTML",function(e){return $.apptools.templates.outerHTML.call(this,e,t)});return r};if(t.templates&&_.is_array(t.templates)){o=t.templates;t.templates={};while(s=o.shift()){s=s.call(t,t);if(s.name.match(/system/gi)){s.singleton=true;s.cache=[];s.__defineSetter__("node",function(e){this.cache.push(this.current);this.current=e;return this});s.__defineGetter__("node",function(){return this.current})}else{s.bind=function(e){this.node=e;delete this.bind;return this}}s.temp=[];t.templates[s.name]=s;continue}}else{if(_("#templates")!=null){if(_("#templates").find!=null){o=_.to_array(_("#templates").find("script"))||[];t.templates={};while(s=o.shift()){i=!!s.data("singleton");e=s.getAttribute("id");r=s.innerText.replace(/[\r\t\n]/g,"").replace(/\s{3,}/g,"");a=n.make(e,r.replace(/\[\[\[\s*?([^\]]+)\s*?\]\]\]/g,function(e,t){return"{{"+t+"}}"}));a.temp=[];if(i){a.singleton=true;a.cache=[];a.__defineSetter__("node",function(e){this.cache.push(this.current);this.current=e;return this});a.__defineGetter__("node",function(){return this.current})}else{a.bind=function(e){this.node=e;delete this.bind;return this}}s.remove();t.templates[e]=a;continue}}}}delete n._init;n._state.init=true;return n};this.register=function(e,t){var r,i;if((r=n._state.index[e])!=null){return n._state.data[r]}if(!(t!=null)&&_.is_raw_object(e)){t=e.template;e=e.name}if(!!!t){return false}else{t.uuid=i=ot.uuid();n._state.index[i]=n._state.index[e]=n._state.data.push(t)-1;n._state.count++;return t}};this.make=this.create=function(e,t){if(n._state.index[e]!=null){return false}return n.register(e,new ot(t,true,e))};this.get=function(e){var t;return(t=n._state.index[e])!=null?n._state.data[t]:false};return this}return t}(i);this.__apptools_preinit.abstract_base_classes.push(O,V,e,H,ot,lt,at,d);this.__apptools_preinit.abstract_feature_interfaces.push(m,O,V,e);this.__apptools_preinit.deferred_core_modules.push({module:at});S=function(e){At(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(i);A=function(e){At(t,e);t.mount="analytics";t["export"]="private";t.events=["ANALYTICS_INIT","ANALYTICS_PUSH","ANALYTICS_EVENT","ANALYTICS_READY","ANALYTICS_CONFIG","ANALYTICS_SETVAR","ANALYTICS_TRACK_EVENT","ANALYTICS_TRACK_SOCIAL","ANALYTICS_TRACK_TIMING","ANALYTICS_TRACK_PAGEVIEW","ANALYTICS_TRACK_CAMPAIGN","ANALYTICS_TRACK_TRANSACTION","ANALYTICS_TRANSACTION_NEWITEM","ANALYTICS_TRANSACTION_COMPLETE"];function t(e,t){var n=this;this.state={vars:{},agent:{},trackers:{},initialized:false,data:{events:[],social:[],timing:[],campaigns:[],transactions:[]},index:{timing:{},networks:{},campaigns:{},transactions:{}},_ga:{queue:null,tracker:null,scopes:["visitor","session","page"],bindings:{ANALYTICS_SETVAR:"_setCustomVar",ANALYTICS_TRACK_EVENT:"_trackEvent",ANALYTICS_TRACK_SOCIAL:"_trackSocial",ANALYTICS_TRACK_TIMING:"_trackTiming",ANALYTICS_TRACK_PAGEVIEW:"_trackPageview",ANALYTICS_TRACK_CAMPAIGN:"_setCampaignTrack",ANALYTICS_TRACK_TRANSACTION:"_addTrans",ANALYTICS_TRANSACTION_NEWITEM:"_addItem",ANALYTICS_TRANSACTION_COMPLETE:"_trackTrans"}},config:{account_ids:{},linker:true,anonymize:false,samplerate:1,multitrack:false}};this._init=function(e){};this.internal={initialize:function(e,r,i,s){var o,a,l,u,c,f,p,h,d,g,y,v,m,b,A,S;if(i==null){i=null}if(s==null){s=null}if(!n.state.initialized){$.apptools.dev.verbose("Analytics","Initializing Google Analytics integration.");if(!(i!=null)&&t._gac!=null){i=t._gac}n.state.config=_.extend(true,{},n.state.config,i);$.apptools.dev.verbose("Analytics","Merged analytics config.",i);n.internal.bind_events();u=[function(){var e,t,n,r;n=this.state.config.account_ids;r=[];for(e=0,t=n.length;e<t;e++){c=n[e];r.push(c)}return r}.call(n)];n.state.initialized=u.length;n.state._ga.queue=e;n.state._ga.tracker=r;A=n.state.config.account_ids;for(f in A){y=A[f];n.internal.provision_tracker(f,y);if(n.state.config.multitrack){continue}else{break}}if(t.__clock!=null&&t.__clock.ts.length>0){S=t.__clock.ts;for(m=0,b=S.length;m<b;m++){l=S[m];if(_.is_array(l)){h=l[0],o=l[1];a=o[0],v=o[1],g=o[2],p=o[3],d=o[4];n.track.timing(a,v,Math.floor(h)-Math.floor(g),p,d)}}}}return n},bind_events:function(e){_.bind("ANALYTICS_INIT",function(t){var r;$.apptools.dev.verbose("Analytics","Tracker initialized.",t);r=[];if(n.state.config.linker){r.push(["_setAllowLinker",true])}r.push(["_setAccount",n.state.config.account_ids[t.name]]);if(e!=null&&e.srcElement.hasAttribute("data-hostname")){r.push(["_setDomainName",e.srcElement.getAttribute("data-hostname")])}if(n.state.config.samplerate!=null){r.push(["_setSiteSpeedSampleRate",n.state.config.samplerate])}else{n.state.config.samplerate=30}n.internal.push_command(r,t.name);n.state.initialized--;if(n.state.initialized===0){n.state.initialized=true;_.trigger("ANALYTICS_READY",n.state.trackers)}});_.bind("ANALYTICS_PUSH",function(){var e,t;t=arguments[0],e=2<=arguments.length?St.call(arguments,1):[];$.apptools.dev.verbose("Analytics","Pushing tracker command.",t,e);e.unshift(t);n.internal.push_command(e)});_.bind("ANALYTICS_READY",function(e){$.apptools.dev.verbose("Analytics","Analytics is READY to receive events.","config:",n.state.config,"trackers:",e);return _.trigger("ANALYTICS_PUSH",["_trackPageview"])});_.bridge(["ANALYTICS_SETVAR","ANALYTICS_TRACK_EVENT","ANALYTICS_TRACK_SOCIAL","ANALYTICS_TRACK_TIMING","ANALYTICS_TRACK_PAGEVIEW","ANALYTICS_TRACK_CAMPAIGN","ANALYTICS_TRACK_TRANSACTION","ANALYTICS_TRANSACTION_NEWITEM","ANALYTICS_TRANSACTION_COMPLETE"],["ANALYTICS_PUSH"],function(e,t){var r,i,s,o,a;r=[n.state._ga.bindings[t]];if(_.is_array(e)&&e.length>1){for(o=0,a=e.length;o<a;o++){s=e[o];if(s!=null){r.push(s)}else{continue}}}else{if(_.is_object(e)&&!_.is_array(e)||e.length===1&&_.is_object(e[0])){if(!_.is_object(e)){e=e[0]}for(i in e){s=e[i];if(s!=null){r.push(s)}}}else{r.push(e[0])}}return r});_.bridge(["ANALYTICS_INIT","ANALYTICS_PUSH","ANALYTICS_READY"],["ANALYTICS_EVENT"],function(e,t){var n;n=t.split("_")[1];e.unshift(n);$.apptools.dev.verbose("Analytics",'Emitted "'+n+'".',e);return e});return n.mappings},provision_tracker:function(e,t){n.state.trackers[e]=n.state._ga.tracker._createTracker(t,e);$.apptools.events.trigger("ANALYTICS_INIT",{name:e,tracker:n.state.trackers[e]});return n.state.trackers[e]},push_command:function(e,t){var r,i,s,o,a,l,u,c,f,p,h;if(t==null){t=null}$.apptools.dev.verbose("Analytics","Pushing command.",e,t);if(t===null){a=_.extend({},n.state.trackers)}else{if(_.is_array(t)){for(u=0,f=t.length;u<f;u++){o=t[u];a[o]=n.state.trackers[o]}}else{a={};a[t]=n.state.trackers[t]}}$.apptools.dev.verbose("Analytics","Resolved target trackers.",a);l=0;for(s in a){t=a[s];i=[];if(_.is_array(e)){if(_.is_string(e[0])){e[0]=[s,e[0]].join(".");i.push(e)}else{for(c=0,p=e.length;c<p;c++){r=e[c];if(!_.is_string(r[0])){continue}else{r[0]=[s,r[0]].join(".")}i.push(r)}}}(h=n.state._ga.queue).push.apply(h,i);$.apptools.dev.verbose("Analytics",'Pushed command to tracker "'+s+'".',i);l++}$.apptools.dev.log("Analytics","Pushed command to "+l.toString()+" trackers.",e,a);return l}};this.config={flash:function(e){if(e==null){e=null}if(e!=null){return n.state._ga.tracker._setDetectFlash(e)}return n.state._ga.tracker._getDetectFlash()},title:function(e){if(e==null){e=null}if(e!=null){return n.state._ga.tracker._setDetectTitle(e)}return n.state._ga.tracker._getDetectTitle()},client:function(e){if(e==null){e=null}if(e!=null){return n.state._ga.tracker._setClientInfo(e)}return n.state._ga.tracker._getClientInfo()},anonymize:function(e){if(e==null){e=null}if(e!=null){n.state.config.anonymize=e}return n.state.config.anonymize},samplerate:function(e){if(e==null){e=null}if(e!=null){n.state.config.samplerate=e}return n.state.config.samplerate}};this.vars={set:function(e,t,r,i){if(i==null){i="page"}if(_.is_string(i)){i=_.indexOf(n.state.config._ga.scopes,i)}_.trigger.apply(_,["ANALYTICS_SETVAR"].concat(St.call([e,t,r,i])));return n}};this.track={event:function(e,t,r,i,s){var o;if(r==null){r=null}if(i==null){i=null}if(s==null){s=false}o=[e,t];if(r!=null){o.push(r)}if(i!=null){o.push(i)}if(s!==false){o.push(s)}_.trigger.apply(_,["ANALYTICS_TRACK_EVENT"].concat(St.call(o)));return n},social:function(e,t,r,i){var s;if(r==null){r=null}if(i==null){i=null}s=[e,t];if(r!=null){s.push(r)}if(i!=null){s.push(i)}_.trigger.apply(_,["ANALYTICS_TRACK_SOCIAL"].concat(St.call(s)));return n},timing:function(e,t,r,i,s){var o;if(s==null){s=null}o=[e,t,r,i];if(s!=null){o.push(s)}else{o.push(n.state.config.samplerate)}_.trigger.apply(_,["ANALYTICS_TRACK_TIMING"].concat(St.call(o)));return n},pageview:function(e){var t;if(e==null){e=null}t=[];if(e!=null){t.push(e)}_.trigger.apply(_,["ANALYTICS_TRACK_PAGEVIEW"].concat(St.call(t)));return n},campaign:function(e,t,n,r,i,s){if(s==null){s=null}},transaction:function(e,t,n,r,i,s,o,a){}};this.transactions={item:function(e,t,n,r,i,s){},complete:function(e){if(e==null){e=null}}}}return t}(S);window.GoogleAnalytics=A;this.__apptools_preinit.abstract_base_classes.push(A);this.__apptools_preinit.installed_integrations.push(A);this.__apptools_preinit.deferred_core_modules.push({module:A});t=function(){e.version={major:0,minor:1,micro:5,build:8272012,release:"BETA",get:function(){var e;return[[[function(){var t,n,r,i;r=[this.major,this.minor,this.micro];i=[];for(t=0,n=r.length;t<n;t++){e=r[t];i.push(e.toString())}return i}.call(this)].join("."),this.build.toString()].join("-"),this.release].join(" ")}};function e(e){var t,n,r,i,a,u,c,p,y=this;t={transport:{rpc:{host:null,enabled:true,base_uri:"/_api/rpc"},sockets:{host:null,enabled:false,endpoint:"/_api/realtime"}},devtools:{debug:true,strict:false}};this.lib={};this.sys={platform:{},version:this.version,core_events:["SYS_MODULE_LOADED","SYS_LIB_LOADED","SYS_DRIVER_LOADED","PLATFORM_READY"],state:{core:[],config:{},status:"NOT_READY",flags:["base","beta"],preinit:{},modules:{},classes:{},drivers:{},interfaces:{},integrations:[],add_flag:function(e){return y.sys.state.flags.push(e)},consider_preinit:function(t){var n,r,i,s,o,a,l,u,c,f,p,h,d,_,g,v;if(t.abstract_base_classes!=null){d=t.abstract_base_classes;for(o=0,l=d.length;o<l;o++){n=d[o];y.sys.state.classes[n.name]=n;if(n["package"]!=null&&y.sys.state.modules[n["package"]]!=null){y.sys.state.modules[n["package"]].classes[n.name]=n}if(n["export"]!=null&&n["export"]==="private"){continue}else{e[n.name]=n}}}if(t.deferred_library_integrations!=null){_=t.deferred_library_integrations;for(a=0,u=_.length;a<u;a++){r=_[a];y.sys.libraries.install(r.name,r.library)}}if(t.abstract_feature_interfaces!=null){g=t.abstract_feature_interfaces;for(p=0,c=g.length;p<c;p++){s=g[p];y.sys.interfaces.install(s)}}if(t.installed_drivers!=null){v=t.installed_drivers;for(h=0,f=v.length;h<f;h++){i=v[h];y.sys.drivers.install(i)}}return t}},modules:{install:function(t,n,r){var i,s,o,a,l,u,c,f,p,h;if(n==null){n=null}if(r==null){r=null}if(!_.is_array(t)||n!=null||r!=null){a=[t]}else{a=t}if(n!=null){if(typeof n==="function"){r=n;l=null}else{l=n}}if(l!=null){if(!(y[l]!=null)){y[l]={}}l=y[l];u=true}else{l=y;u=false}i=[];for(p=0,h=a.length;p<h;p++){s=a[p];if(s.mount!=null){o=s.mount}else{o=s.name.toLowerCase()}if(s.events!=null&&y.events!=null){y.events.register(s.events)}if(!(l[o]!=null)){if(u){c=new s(y,l,e);l[o]=c;y.sys.state.modules[o]={module:c,classes:{}}}else{c=new s(y,e);l[o]=c;y.sys.state.modules[o]={module:c,classes:{}}}}if(typeof(f=l[o])._init==="function"){f._init(y)}delete l[o]._init;if(y.dev!=null&&y.dev.verbose!=null){y.dev.verbose("ModuleLoader","Installed module:",c," at mountpoint: ",l," under the name: ",o)}if(y.events!=null){y.events.trigger("SYS_MODULE_LOADED",{module:c,mountpoint:l})}if(r!=null){r(c)}i.push(c)}return i}},libraries:{install:function(e,t,n){if(n==null){n=null}y.lib[e.toLowerCase()]=t;y.sys.state.integrations.push(e.toLowerCase());y.dev.verbose("Library",e+" detected.");y.events.trigger("SYS_LIB_LOADED",{name:e,library:t});if(n!=null){n(t,e)}return y.lib[e.toLowerCase()]},resolve:function(e){e=e.toLowerCase();if(y.lib[e.toLowerCase()]!=null){return y.lib[e.toLowerCase()]}}},interfaces:{install:function(e){if(e.name!=null&&e.adapter!=null){e=new e.adapter(y)}else{e=new e(y)}y.dev.verbose("Interface",'Installed "'+e.capability+'" interface.',e);if(e.parent!==null){if(_.is_string(e.parent)){if(!(y.sys.state.interfaces[e.parent]!=null)){y.dev.error("System","Encountered interface with invalid parent reference.",e,e.parent);throw"Parent interface references must be valid and child interfaces must be loaded after their parents."}else{y.sys.state.interfaces[e.parent].children[e.capability]={adapter:e,children:{}};y.events.trigger("SYS_INTERFACE_LOADED",{adapter:y.sys.state.interfaces[e.parent].children[e.capability].adapter})}}else{if(!(y.sys.state.interfaces[e.parent.prototype.capability]!=null)){y.dev.error("System","Encountered interface with invalid parent reference.",e,e.parent);throw"Parent interface references must be valid and child interfaces must be loaded after their parents."}else{y.sys.state.interfaces[e.parent.prototype.capability].children[e.capability]={adapter:e,children:{}};y.events.trigger("SYS_INTERFACE_LOADED",{adapter:y.sys.state.interfaces[e.parent.prototype.capability].children[e.capability].adapter})}}}else{y.sys.state.interfaces[e.capability]={adapter:e,children:{}};y.events.trigger("SYS_INTERFACE_LOADED",{adapter:y.sys.state.interfaces[e.capability].adapter})}return y.sys.state.interfaces[e.capability]},resolve:function(e){var t,n,r,i,s;if(!_.is_string(e)){if(e.prototype.parent!=null){n=[e.prototype.parent.prototype.capability,e.prototype.capability].join(".")}else{n=e.prototype.capability}}else{n=String(e).toLowerCase()}t=n.split(".");if(t.length>1){if(((r=y.sys.state.interfaces[t[0]])!=null?r.children[t[1]]:void 0)!=null){return(i=y.sys.state.interfaces[t[0]])!=null?(s=i.children[t[1]])!=null?s.adapter:void 0:void 0}return false}if(y.sys.state.interfaces[n]!=null){if(y.sys.state.interfaces[n]!=null){return y.sys.state.interfaces[n].adapter}return false}},children:function(e){if(!_.is_string(e)){e=e.capability}if(e.contains(".")){return false}if(!(y.sys.state.interfaces[e]!=null)){y.dev.error('Failed to resolve interface children for missing interface "'+e+'".');throw'Failed to resolve interface children for missing interface "'+e+'".'}return y.sys.state.interfaces[e].children}},drivers:{install:function(t){var n,r,i,s,o,a,l,u,c;if(!_.is_string(t.name)){y.dev.error("System","Encountered driver without a valid name.",t,t.name);throw"Drivers must have a string name attached at `driver.name`."}if(y.sys.state.drivers[t.name]!=null){return y.dev.log("System",'Encountered a driver conflict installing "'+t.name+'".',"original: ",y.sys.state.drivers[t.name],"conflict: ",t)}else{if(t.prototype["native"]!=null&&t.prototype["native"]===true||t.prototype.library!=null||t.prototype.compatible!=null&&t.prototype.compatible()===true){r=function(){var e,r,i,s;i=t.prototype["interface"];s=[];for(e=0,r=i.length;e<r;e++){n=i[e];s.push(this.sys.interfaces.resolve(n))}return s}.call(y);if(t.prototype.library!=null){t=y.sys.state.drivers[t.name]=new t(t.prototype.library,y,e)}else{t=y.sys.state.drivers[t.name]=new t(y,e)}c=[];for(s=0,a=r.length;s<a;s++){n=r[s];if(!(t[n.capability]!=null)){y.dev.warning("System",'Encountered driver ("'+t.name+'") with incomplete implementation for interface "'+n.capability+'".',n,t)}if(n.required!=null){u=n.required;for(o=0,l=u.length;o<l;o++){i=u[o];if(!(t[n.capability][i]!=null)){y.dev.error("System",'Encountered driver ("'+t.name+'") without required implementation method ("'+i+'") for attached interface "'+n.capability+'".',n,t);throw"Encountered fatal driver validation error."}}}c.push(n.add(t))}return c}else{y.dev.verbose("System",'Installed driver "'+t.name+'" was found to be incompatible with the current environment.');return false}}},resolve:function(e,t){var n;if(t==null){t=null}n=y.sys.interfaces.resolve(e);return n.resolve(t)}},go:function(e){e.dev.log("Core","All systems go.");e.sys.state.status="READY";e.events.trigger("PLATFORM_READY",e);return y}};if(e.config!=null&&_.is_object(e.config)){i=e.config;this.sys.state.config=_.extend(t,this.sys.state.config,e.config)}else{n=e._cfgst||"js-config";i=document.getElementById(n);if(i!=null){this.sys.state.config=_.extend(t,this.sys.state.config,JSON.parse(i.innerText))}else{this.sys.state.config=_.extend({},t,this.sys.state.config)}}if(this.sys.state.config.debug!=null){o.prototype.debug=_.extend({},o.prototype.debug,this.sys.state.config.debug)}this.sys.modules.install(o,function(e){return y.sys.modules.install(l,function(e){return e.register(y.sys.core_events)})});this.sys.state.preinit=e.__apptools_preinit||e.__preinit;if(this.sys.state.preinit!=null){this.sys.state.consider_preinit(e.__apptools_preinit)}this.sys.state.core=[f,s,h,g,v,d];this.sys.modules.install(this.sys.state.core);if(((c=e.__apptools_preinit)!=null?c.deferred_core_modules:void 0)!=null){p=e.__apptools_preinit.deferred_core_modules;for(a=0,u=p.length;a<u;a++){r=p[a];if(r["package"]!=null){this.sys.modules.install(r.module,r["package"])}else{this.sys.modules.install(r.module)}}}if(e.__clock!=null){if(this.analytics!=null){this.dev.verbose("Analytics","Installing Google Analytics timings integration.");e.__clock.track=function(e){var t,n,r,i,s,o,a;i=e[0],t=e[1];n=t[0],a=t[1],o=t[2],r=t[3],s=t[4];y.analytics.track.timing(n,a,Math.floor(i)-Math.floor(o),r,s);return e}}}return this.sys.go(this)}return e}();window.AppTools=t;window.apptools=new t(window);if(window.jQuery!=null){$.extend({apptools:window.apptools})}else if(window.$!=null){window.$.apptools=window.apptools}else{(window.$=function(e){return document.getElementById(e)}).apptools=window.apptools}if(window.__clock!=null){window.__clock.clockpoint("JavaScript","Platform Ready",window.__clock.ts[0],"AppTools",100)}}).call(this);